<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berita - SD Cerdas Ceria</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header & Navigation -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>SD Cerdas Ceria</span>
                </div>
                
                <ul class="nav-menu">
                    <li class="nav-item"><a href="index.html" class="nav-link">Beranda</a></li>
                    <li class="nav-item"><a href="profil.html" class="nav-link">Profil</a></li>
                    <li class="nav-item"><a href="berita.html" class="nav-link active">Berita</a></li>
                    <li class="nav-item"><a href="akademik.html" class="nav-link">Akademik</a></li>
                    <li class="nav-item dropdown">
                        <a href="info.html" class="nav-link dropdown-toggle">Info</a>
                        <ul class="dropdown-menu">
                            <li><a href="info.html">Informasi Umum</a></li>
                            <li><a href="transparansi.html">Transparansi</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a href="inovasi.html" class="nav-link">Inovasi</a></li>
                    <li class="nav-item"><a href="kontak.html" class="nav-link">Kontak</a></li>
                </ul>
                
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <div class="page-header-content">
                <h1>Berita Sekolah</h1>
                <p>Informasi terkini seputar kegiatan dan pencapaian SD Cerdas Ceria</p>
                <nav class="breadcrumb">
                    <a href="index.html">Beranda</a>
                    <span>/</span>
                    <span>Berita</span>
                </nav>
            </div>
        </div>
    </section>

    <!-- News Content -->
    <section class="news-content">
        <div class="container">
            <!-- Loading State -->
            <div id="loading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div>
                <p class="mt-4 text-gray-600">Memuat berita...</p>
            </div>

            <!-- Error State -->
            <div id="error" class="text-center py-12 hidden">
                <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                <p class="text-gray-600 mb-4">Gagal memuat berita. Silakan coba lagi.</p>
                <button onclick="loadNews()" class="btn btn-primary">
                    <i class="fas fa-refresh mr-2"></i>Muat Ulang
                </button>
            </div>

            <!-- Filter & Search -->
            <div id="filters" class="mb-8 hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pencarian</label>
                            <input type="text" id="searchInput" placeholder="Cari berita..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                            <select id="categoryFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                                <option value="">Semua Kategori</option>
                                <option value="umum">Umum</option>
                                <option value="prestasi">Prestasi</option>
                                <option value="kegiatan">Kegiatan</option>
                                <option value="pengumuman">Pengumuman</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="filterNews()" class="w-full px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                                <i class="fas fa-search mr-2"></i>Filter
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Featured News -->
            <div id="featuredNews" class="mb-12 hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Berita Unggulan</h2>
                <div id="featuredContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <!-- News List -->
            <div id="newsList" class="hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Semua Berita</h2>
                    <div id="resultsInfo" class="text-sm text-gray-600"></div>
                </div>
                <div id="newsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="mt-12 text-center hidden">
                <div class="inline-flex space-x-2"></div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 hidden">
                <i class="fas fa-newspaper text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-600">Tidak ada berita yang ditemukan.</p>
            </div>
        </div>
    </section>

    <!-- News Detail Modal -->
    <div id="newsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="min-h-screen px-4 text-center">
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                <div class="bg-white px-6 py-4">
                    <div class="flex items-center justify-between border-b pb-4">
                        <h3 id="modalTitle" class="text-lg font-medium text-gray-900"></h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div id="modalContent" class="mt-4 max-h-96 overflow-y-auto"></div>
                    <div id="modalMeta" class="mt-4 pt-4 border-t text-sm text-gray-500"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-graduation-cap"></i>
                        <span>SD Cerdas Ceria</span>
                    </div>
                    <p>Membentuk generasi cerdas dan berkarakter untuk masa depan Indonesia yang lebih baik.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 SD Cerdas Ceria. Semua hak dilindungi undang-undang.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
    // News API Integration
    let currentPage = 1;
    let currentCategory = '';
    let currentSearch = '';
    const itemsPerPage = 9;

    // API Base URL
    const API_URL = '/sd/api/news.php';

    // Initialize news page
    document.addEventListener('DOMContentLoaded', function() {
        loadNews();
        loadFeaturedNews();
        
        // Setup search input with debounce
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentSearch = this.value;
                currentPage = 1;
                loadNews();
            }, 500);
        });
    });

    // Load featured news
    async function loadFeaturedNews() {
        try {
            const response = await fetch(`${API_URL}?action=featured&limit=3`);
            const data = await response.json();
            
            if (data.success && data.data.length > 0) {
                displayFeaturedNews(data.data);
            }
        } catch (error) {
            console.error('Error loading featured news:', error);
        }
    }

    // Load regular news list
    async function loadNews() {
        showLoading();
        hideError();
        
        try {
            let url = `${API_URL}?action=list&page=${currentPage}&limit=${itemsPerPage}`;
            
            if (currentCategory) {
                url += `&category=${currentCategory}`;
            }
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.success) {
                displayNews(data.data);
                displayPagination(data.pagination);
                updateResultsInfo(data.pagination);
                showContent();
            } else {
                throw new Error(data.message || 'Failed to load news');
            }
        } catch (error) {
            console.error('Error loading news:', error);
            showError();
        }
    }

    // Display featured news
    function displayFeaturedNews(news) {
        const container = document.getElementById('featuredContainer');
        const featuredSection = document.getElementById('featuredNews');
        
        if (news.length === 0) {
            featuredSection.classList.add('hidden');
            return;
        }
        
        container.innerHTML = news.map(item => `
            <div class="news-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow cursor-pointer" onclick="openNewsModal('${item.slug}')">
                ${item.featured_image ? 
                    `<img src="${item.featured_image}" alt="${item.title}" class="w-full h-48 object-cover">` : 
                    `<div class="w-full h-48 bg-gradient-to-r from-primary-400 to-purple-500 flex items-center justify-center">
                        <i class="fas fa-newspaper text-white text-4xl"></i>
                    </div>`
                }
                <div class="p-6">
                    <div class="flex items-center mb-2">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            <i class="fas fa-star mr-1"></i>Unggulan
                        </span>
                        <span class="ml-2 text-xs text-gray-500 capitalize">${item.category}</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">${item.title}</h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-3">${item.excerpt}</p>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span><i class="fas fa-calendar mr-1"></i>${item.formatted_date}</span>
                        <span><i class="fas fa-eye mr-1"></i>${item.views.toLocaleString()}</span>
                    </div>
                </div>
            </div>
        `).join('');
        
        featuredSection.classList.remove('hidden');
    }

    // Display news list
    function displayNews(news) {
        const container = document.getElementById('newsContainer');
        const newsList = document.getElementById('newsList');
        const emptyState = document.getElementById('emptyState');
        
        if (news.length === 0) {
            newsList.classList.add('hidden');
            emptyState.classList.remove('hidden');
            return;
        }
        
        container.innerHTML = news.map(item => `
            <div class="news-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow cursor-pointer" onclick="openNewsModal('${item.slug}')">
                ${item.featured_image ? 
                    `<img src="${item.featured_image}" alt="${item.title}" class="w-full h-48 object-cover">` : 
                    `<div class="w-full h-48 bg-gradient-to-r from-primary-400 to-purple-500 flex items-center justify-center">
                        <i class="fas fa-newspaper text-white text-4xl"></i>
                    </div>`
                }
                <div class="p-6">
                    <div class="flex items-center mb-2">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium capitalize ${
                            item.category === 'prestasi' ? 'bg-green-100 text-green-800' : 
                            item.category === 'kegiatan' ? 'bg-blue-100 text-blue-800' : 
                            item.category === 'pengumuman' ? 'bg-red-100 text-red-800' : 
                            'bg-gray-100 text-gray-800'
                        }">
                            ${item.category}
                        </span>
                        ${item.is_featured ? '<span class="ml-2 text-xs text-yellow-600"><i class="fas fa-star"></i></span>' : ''}
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">${item.title}</h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-3">${item.excerpt}</p>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span><i class="fas fa-calendar mr-1"></i>${item.formatted_date}</span>
                        <span><i class="fas fa-eye mr-1"></i>${item.views.toLocaleString()}</span>
                    </div>
                </div>
            </div>
        `).join('');
        
        newsList.classList.remove('hidden');
        emptyState.classList.add('hidden');
    }

    // Display pagination
    function displayPagination(pagination) {
        const container = document.getElementById('pagination');
        
        if (pagination.total_pages <= 1) {
            container.classList.add('hidden');
            return;
        }
        
        let paginationHTML = '';
        
        // Previous button
        if (pagination.current_page > 1) {
            paginationHTML += `<button onclick="changePage(${pagination.current_page - 1})" class="px-3 py-2 text-sm bg-white text-gray-700 border border-gray-300 rounded-l-md hover:bg-gray-50">‹ Sebelumnya</button>`;
        }
        
        // Page numbers
        const startPage = Math.max(1, pagination.current_page - 2);
        const endPage = Math.min(pagination.total_pages, pagination.current_page + 2);
        
        for (let i = startPage; i <= endPage; i++) {
            const isActive = i === pagination.current_page;
            paginationHTML += `<button onclick="changePage(${i})" class="px-3 py-2 text-sm border ${isActive ? 'bg-primary-600 text-white border-primary-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'}">${i}</button>`;
        }
        
        // Next button
        if (pagination.current_page < pagination.total_pages) {
            paginationHTML += `<button onclick="changePage(${pagination.current_page + 1})" class="px-3 py-2 text-sm bg-white text-gray-700 border border-gray-300 rounded-r-md hover:bg-gray-50">Selanjutnya ›</button>`;
        }
        
        container.querySelector('div').innerHTML = paginationHTML;
        container.classList.remove('hidden');
    }

    // Update results info
    function updateResultsInfo(pagination) {
        const info = document.getElementById('resultsInfo');
        const start = (pagination.current_page - 1) * pagination.per_page + 1;
        const end = Math.min(pagination.current_page * pagination.per_page, pagination.total_records);
        info.textContent = `Menampilkan ${start}-${end} dari ${pagination.total_records} berita`;
    }

    // Change page
    function changePage(page) {
        currentPage = page;
        loadNews();
        
        // Scroll to top of news content
        document.getElementById('newsList').scrollIntoView({ behavior: 'smooth' });
    }

    // Filter news by category
    function filterNews() {
        currentCategory = document.getElementById('categoryFilter').value;
        currentPage = 1;
        loadNews();
    }

    // Show/hide states
    function showLoading() {
        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('newsList').classList.add('hidden');
        document.getElementById('pagination').classList.add('hidden');
        document.getElementById('emptyState').classList.add('hidden');
    }

    function showContent() {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('filters').classList.remove('hidden');
    }

    function showError() {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
        document.getElementById('newsList').classList.add('hidden');
    }

    function hideError() {
        document.getElementById('error').classList.add('hidden');
    }

    // Open news detail modal
    async function openNewsModal(slug) {
        try {
            const response = await fetch(`${API_URL}?action=detail&slug=${slug}`);
            const data = await response.json();
            
            if (data.success) {
                const news = data.data;
                document.getElementById('modalTitle').textContent = news.title;
                document.getElementById('modalContent').innerHTML = `
                    ${news.featured_image ? `<img src="${news.featured_image}" alt="${news.title}" class="w-full h-64 object-cover rounded-lg mb-4">` : ''}
                    <div class="prose max-w-none">${news.content}</div>
                `;
                document.getElementById('modalMeta').innerHTML = `
                    <div class="flex flex-wrap items-center gap-4">
                        <span class="capitalize"><i class="fas fa-tag mr-1"></i>${news.category}</span>
                        <span><i class="fas fa-calendar mr-1"></i>${news.formatted_date}</span>
                        <span><i class="fas fa-eye mr-1"></i>${news.views.toLocaleString()} views</span>
                    </div>
                `;
                document.getElementById('newsModal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        } catch (error) {
            console.error('Error loading news detail:', error);
            showToast('Gagal memuat detail berita', 'error');
        }
    }

    // Close modal
    function closeModal() {
        document.getElementById('newsModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    // Close modal when clicking outside
    document.getElementById('newsModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });

    // Add CSS for line-clamp (if not already present)
    if (!document.querySelector('[data-news-styles]')) {
        const style = document.createElement('style');
        style.setAttribute('data-news-styles', 'true');
        style.textContent = `
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            .line-clamp-3 {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            .prose {
                color: #374151;
                line-height: 1.7;
            }
            .prose h1, .prose h2, .prose h3 {
                color: #111827;
                margin-top: 1.5em;
                margin-bottom: 0.5em;
            }
            .prose p {
                margin-bottom: 1em;
            }
            .prose img {
                max-width: 100%;
                height: auto;
                border-radius: 0.5rem;
                margin: 1em 0;
            }
        `;
        document.head.appendChild(style);
    }
    </script>
</body>
</html>
